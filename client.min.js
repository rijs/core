var core=function(){"use strict";function n(n){return function(r){return r==n}}function r(n){return function(r){return p(r)(n)}}var e=function(){var n,r,e=new Promise(function(e,t){n=e,r=t});return arguments.length&&n(arguments[0]),e.resolve=n,e.reject=r,e},t=function n(r,e){return e instanceof Array&&(e=e.reduce(n,[])),(r=r||[]).concat(e)},o=function(n,r){return r in n},u=function(n,r,e,t){return n.host&&n.host.nodeName&&(n=n.host),r.name&&(e=r,r=r.name),!o(n,r)&&Object.defineProperty(n,r,{value:e,writable:t}),n[r]},i=function n(r){function o(n,e){return n.next?n.next(e):e instanceof Array?n.apply(r,e):n.call(r,e)}function i(n,r){for(var e=n.length;~--e;)r!=n[e]&&r!=n[e].fn&&r||n.splice(e,1)}function c(r,t){var o=n((t=t||{}).base||e());return o.i=0,o.li=[],o.fn=t.fn,o.parent=r,o.source=t.fn?o.parent.source:o,o.on("stop",function(){return o.type?o.parent.off(o.type,o):o.parent.off(o)}),o.each=function(n){var r=n.next?n:c(o,{fn:n});return o.li.push(r),r},o.pipe=function(n){return n(o)},o.map=function(n){return o.each(function(r,e,t){return t.next(n(r,e,t))})},o.filter=function(n){return o.each(function(r,e,t){return n(r,e,t)&&t.next(r)})},o.reduce=function(n,r){return o.each(function(e,t,o){return o.next(r=n(r,e,t,o))})},o.unpromise=function(){var n=c(o,{base:{},fn:function(r){return n.next(r)}});return o.li.push(n),n},o.next=function(n){return o.resolve&&o.resolve(n),o.li.length?o.li.map(function(r){return r.fn(n,r.i++,r)}):n},o.until=function(n){return n.each(function(){o.source.emit("stop")}),o},o.off=function(n){return i(o.li,n),o},o[Symbol.asyncIterator]=function(){return{next:function(){return o.wait=new Promise(function(n){o.wait=!0,o.map(function(r,e,t){delete o.wait,o.off(t),n({value:r,done:!1})}),o.emit("pull",o)})}}},o}return r=r||{},u(r,"emit",function(n,e,u){for(var i=r.on[n.split(".")[0]]||[],c=[],f=0;f<i.length;f++)i[f].ns&&u&&!u(i[f].ns)||c.push(o(i[f].isOnce?i.splice(f--,1)[0]:i[f],e));for(f=0;f<r.on["*"].length;f++)c.push(o(r.on["*"][f],[n,e]));return c.reduce(t,[])},1),u(r,"once",function(n,e){return r.on(n,e,!0)},1),u(r,"off",function(n,e){return i(r.on[n]||[],e),e&&e.ns&&delete r.on[n]["$"+e.ns],r},1),u(r,"on",function(n,e,t){function o(n){return n.isOnce=t,n.type=u,f&&(r.on[u]["$"+(n.ns=f)]=n),a.push(n),n.next?n:r}var u=n.split(".")[0],f=n.split(".")[1],a=r.on[u]=r.on[u]||[],s="function"==typeof e?e:0;return!s&&f?(s=r.on[u]["$"+f])?s:o(c(r,e)):s||f?s&&f?o((i(a,r.on[u]["$"+f]||-1),s)):!(!s||f)&&o(s):o(c(r,e))},1),r.on["*"]=r.on["*"]||[],r},c="undefined"!=typeof window,f=n;n.fn=function(n){return"function"==typeof n},n.str=function(n){return"string"==typeof n},n.num=function(n){return"number"==typeof n},n.obj=function(n){return"object"==typeof n},n.lit=function(n){return"object"==typeof n&&!(n instanceof Array)},n.bol=function(n){return"boolean"==typeof n},n.truthy=function(n){return 1==!!n},n.falsy=function(n){return 0==!!n},n.arr=function(n){return n instanceof Array},n.null=function(n){return null===n},n.def=function(n){return void 0!==n},n.in=function(n){return function(r){return!!n&&(n.indexOf?~n.indexOf(r):r in n)}},n.promise=function(n){return n instanceof Promise},n.stream=function(n){return!(!n||!n.next)};["red","green","bold","grey","strip"].forEach(function(n){!f.str(String.prototype[n])&&Object.defineProperty(String.prototype,n,{get:function(){return String(this)}})});var a=function(n){return n},s=function(n){return function(){return n}},l=function(n){return 0===n?"0":n?f.fn(n)?""+n:f.obj(n)?JSON.stringify(n):String(n):""},p=function n(r,e){var t=arguments.length>1,o=f.fn(r)?[]:l(r).split("."),u=o.shift();return function(i,c){var a={};return i?f.num(r)||r?f.arr(r)?(r.map(function(r){var e=n(r)(i);void 0!=e&&n(r,f.fn(e)?s(e):e)(a)}),a):i[r]||!o.length?t?(i[r]=f.fn(e)?e(i[r],c):e,i):f.fn(r)?r(i):i[r]:t?(n(o.join("."),e)(i[u]?i[u]:i[u]={}),i):n(o.join("."))(i[u]):i:void 0}},d=function(n,r){var e=1==arguments.length;return function(t){return t&&t.headers?e?p(n)(t.headers):p(n)(t.headers)==r:null}},y=function(n){return Object.keys(f.obj(n)||f.fn(n)?n:{})},h=function(n){return n.__data__},g=r;r.parent=function(n){return h(this.parentNode)[n]};var m=function(n){return n?y(n).map(g(n)):[]},v={arr:function(n){return Array.prototype.slice.call(n,0)},obj:function(n){function r(n,r,t){return 0===t&&(n={}),n[f.fn(e)?e(r,t):r[e]]=r,n}var e="id";return 1==arguments.length?(e=n,r):r.apply(this,arguments)}},b=function(n){return function(r,e){var t=p(n)(r)||"",o=p(n)(e)||"";return t>o?-1:t<o?1:0}},w=function(n){return function(r){return r&&r.indexOf&&~r.indexOf(n)}},x={header:"text/plain",check:function(n){return!w(".html")(n.name)&&!w(".css")(n.name)&&f.str(n.body)}},j="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},O=c?window:j,S=function(n){return function(r){var e=r.name,t=r.body,o=r.headers;if(void 0===o&&(o={}),N("registering",e),f.promise(t))return t.then(function(r){return S(n)({name:e,body:r,headers:o})}).catch(I);var u=A(n)({name:e,body:t,headers:o});return u?(n.resources[e]=u,n.emit("change",[e,{type:"update",value:u.body,time:D(u)}]),n.resources[e].body):(I("failed to register",e),!1)}},A=function(n){return function(r){return d("content-type")(r)||m(n.types).sort(b("priority")).some($(r)),d("content-type")(r)?P(n)(r):(I("could not understand resource",r),!1)}},P=function(n){return function(r){var e=d("content-type")(r);return n.types[e]?(n.types[e].parse||a)(r):(I("could not understand type",e),!1)}},$=function(n){return function(r){return r.check(n)&&(n.headers["content-type"]=r.header)}},_=function(){return[x].reduce(v.obj("header"),1)},k=function(n){return function(){return n.apply(this,arguments),n}},I=function(n){return function(r){if(!O.console||!console.error.apply)return r;f.arr(arguments[2])&&(arguments[2]=arguments[2].length);var e=v.arr(arguments),t="[err]["+(new Date).toISOString()+"]"+n;return e.unshift(t.red?t.red:t),console.error.apply(console,e),r}}("[ri/core]"),N=function(n){return function(r){if(!O.console||!console.log.apply)return r;f.arr(arguments[2])&&(arguments[2]=arguments[2].length);var e=v.arr(arguments),t="[log]["+(new Date).toISOString()+"]"+n;return e.unshift(t.grey?t.grey:t),console.log.apply(console,e),r}}("[ri/core]"),D=function(n,r){return r=p("body.log.length")(n),f.num(r)?r-1:r};return function(){function n(r,e,t){return r?f.arr(r)?r.map(n):f.promise(r)?r.then(n).catch(I):f.obj(r)&&!r.name?n(m(r)):f.fn(r)&&r.resources?n(m(r.resources)):f.str(r)&&!e&&n.resources[r]?n.resources[r].body:!f.str(r)||e||n.resources[r]?f.str(r)&&e?S(n)({name:r,body:e,headers:t}):f.obj(r)&&!f.arr(r)?S(n)(r):(I("could not find or create resource",r),!1):void 0:n}N("creating");var r={};return n.resources=r,n.resource=k(n),n.register=n,n.types=_(),i(n)}}();
