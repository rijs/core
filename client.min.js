var core=function(){"use strict";function n(n){return function(r){return r==n}}function r(n){return function(r){return g(r)(n)}}function e(n){return function(r,t){if(!n.length)return 0;var o=n[0],u=g(o)(r)||"",i=g(o)(t)||"";return u<i?1:u>i?-1:e(n.slice(1))(r,t)}}var t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},o=function(){var n,r,e=new Promise(function(e,t){n=e,r=t});return arguments.length&&n(arguments[0]),e.resolve=n,e.reject=r,e},u=function n(r,e){return e instanceof Array&&(e=e.reduce(n,[])),(r=r||[]).concat(e)},i=function(n,r){return r in n},c=function(n,r,e,t){return n.host&&n.host.nodeName&&(n=n.host),r.name&&(e=r,r=r.name),!i(n,r)&&Object.defineProperty(n,r,{value:e,writable:t}),n[r]},f=function(){},s=function n(r,e){function t(n,e){return n.next?n.next(e):e instanceof Array?n.apply(r,e):n.call(r,e)}function i(n,r){for(var t=n.length;~--t;)r!=n[t]&&r!=n[t].fn&&r||(e.off||f)(n.splice(t,1)[0])}function s(r,e){var t=n((e=e||{}).base||o());return t.i=0,t.li=[],t.fn=e.fn,t.parent=r,t.source=e.fn?t.parent.source:t,t.on("stop",function(n){return t.type?t.parent.off(t.type,t):t.parent.off(t),t.reason=n}),t.each=function(n){var r=n.next?n:s(t,{fn:n});return t.li.push(r),r},t.pipe=function(n){return n(t)},t.map=function(n){return t.each(function(r,e,t){return t.next(n(r,e,t))})},t.filter=function(n){return t.each(function(r,e,t){return n(r,e,t)&&t.next(r)})},t.reduce=function(n,r){return t.each(function(e,t,o){return o.next(r=n(r,e,t,o))})},t.unpromise=function(){var n=s(t,{base:{},fn:function(r){return n.next(r)}});return t.li.push(n),n},t.next=function(n){return t.resolve&&t.resolve(n),t.li.length?t.li.map(function(r){return r.fn(n,r.i++,r)}):n},t.until=function(n){return(n.each||n.then).call(n,function(n){return t.source.emit("stop",n)}),t},t.off=function(n){return i(t.li,n),t},t.start=function(){return t.source.emit("start"),t},t[Symbol.asyncIterator]=function(){return{next:function(){return t.wait=new Promise(function(n){t.wait=!0,t.map(function(r,e,o){delete t.wait,t.off(o),n({value:r,done:!1})}),t.emit("pull",t)})}}},t}return r=r||{},e=e||{},c(r,"emit",function(n,e,o){for(var i=r.on[n.split(".")[0]]||[],c=[],f=0;f<i.length;f++)i[f].ns&&o&&!o(i[f].ns)||c.push(t(i[f].isOnce?i.splice(f--,1)[0]:i[f],e));for(f=0;f<r.on["*"].length;f++)c.push(t(r.on["*"][f],[n,e]));return c.reduce(u,[])},1),c(r,"once",function(n,e){return r.on(n,e,!0)},1),c(r,"off",function(n,e){return i(r.on[n]||[],e),e&&e.ns&&delete r.on[n]["$"+e.ns],r},1),c(r,"on",function(n,t,o){function u(n){return n.isOnce=o,n.type=c,a&&(r.on[c]["$"+(n.ns=a)]=n),l.push(n),(e.on||f)(n),n.next?n:r}var c=n.split(".")[0],a=n.split(".")[1],l=r.on[c]=r.on[c]||[],p="function"==typeof t?t:0;return!p&&a?(p=r.on[c]["$"+a])?p:u(s(r,t)):p||a?p&&a?u((i(l,r.on[c]["$"+a]||-1),p)):!(!p||a)&&u(p):u(s(r,t))},1),r.on["*"]=r.on["*"]||[],r},a="undefined"!=typeof window,l=n;n.fn=function(n){return"function"==typeof n},n.str=function(n){return"string"==typeof n},n.num=function(n){return"number"==typeof n},n.obj=function(n){return"object"==typeof n},n.lit=function(n){return n.constructor==Object},n.bol=function(n){return"boolean"==typeof n},n.truthy=function(n){return 1==!!n},n.falsy=function(n){return 0==!!n},n.arr=function(n){return n instanceof Array},n.null=function(n){return null===n},n.def=function(n){return void 0!==n},n.in=function(n){return function(r){return!!n&&(n.indexOf?~n.indexOf(r):r in n)}},n.promise=function(n){return n instanceof Promise},n.stream=function(n){return!(!n||!n.next)};["red","green","bold","grey","strip"].forEach(function(n){!l.str(String.prototype[n])&&Object.defineProperty(String.prototype,n,{get:function(){return String(this)}})});var p=function(n){return n},d=function(n){return function(){return n}},y=function(n){return Object.keys(l.obj(n)||l.fn(n)?n:{})},h=function(n){return 0===n?"0":n?l.fn(n)?""+n:l.obj(n)?JSON.stringify(n):String(n):""},g=function n(r,e){var t=arguments.length>1,o=l.fn(r)?[]:h(r).split(".").filter(Boolean),u=o.shift();return function(i,c){var f={};return i?l.num(r)||r?l.arr(r)?(r.map(function(r){var t=n(r)(i);void 0!=(t=l.fn(e)?e(t):void 0==t?e:t)&&n(r,l.fn(t)?d(t):t)(f)}),f):i[r]||!o.length?t?(i[r]=l.fn(e)?e(i[r],c):e,i):l.fn(r)?r(i):i[r]:t?(n(o.join("."),e)(i[u]?i[u]:i[u]={}),i):n(o.join("."))(i[u]):t?function(n,r){return y(n).map(function(r){delete n[r]}),y(r).map(function(e){n[e]=r[e]}),n}(i,e):i:void 0}},m=function(n,r){var e=1==arguments.length;return function(t){return t&&t.headers?e?g(n)(t.headers):g(n)(t.headers)==r:null}},v=function(n){return n.__data__},b=r;r.parent=function(n){return v(this.parentNode)[n]};var x=function(n){return n?y(n).map(b(n)):[]},j={arr:function(n){return Array.prototype.slice.call(n,0)},obj:function(n){function r(n,r,t){return 0===t&&(n={}),n[l.fn(e)?e(r,t):r[e]]=r,n}var e="id";return 1==arguments.length?(e=n,r):r.apply(this,arguments)}},w=function(){return e(j.arr(arguments))},O=function(n){return function(r){return r&&r.indexOf&&~r.indexOf(n)}},S={header:"text/plain",check:function(n){return!O(".html")(n.name)&&!O(".css")(n.name)&&l.str(n.body)}},P=a?window:t,k=function(n){return function(r){if(!P.console||!console.error.apply)return r;l.arr(arguments[2])&&(arguments[2]=arguments[2].length);var e=j.arr(arguments),t="[err]["+(new Date).toISOString()+"]"+n;return e.unshift(t.red?t.red:t),console.error.apply(console,e),r}},A=function(n){return function(r){if(!P.console||!console.log.apply)return r;l.arr(arguments[2])&&(arguments[2]=arguments[2].length);var e=j.arr(arguments),t="[log]["+(new Date).toISOString()+"]"+n;return e.unshift(t.grey?t.grey:t),console.log.apply(console,e),r}};return function(n,r){return r={exports:{}},n(r,r.exports),r.exports}(function(n){n.exports=function(n){function e(n,t,o){return n?l.arr(n)?n.map(e):l.promise(n)?n.then(e).catch(f):l.obj(n)&&!n.name?e(x(n)):l.fn(n)&&n.resources?e(x(n.resources)):l.str(n)&&!t&&e.resources[n]?e.resources[n].body:!l.str(n)||t||e.resources[n]?l.str(n)&&t?r(e)({name:n,body:t,headers:o}):l.obj(n)?r(e)(n):(f("could not find or create resource",n),!1):void 0:e}void 0===n&&(n={});var t=n.aliases;return void 0===t&&(t={}),a("creating"),e.resources={},e.link=c(e),e.register=e,e.types=u(),i(s(e),t)};var r=function(n){return function(t){var o=t.name,u=t.body,i=t.headers;if(void 0===i&&(i={}),o=n.aliases.src[o]||o,l.promise(u))return u.then(function(e){return r(n)({name:o,body:e,headers:i})}).catch(f);a("registering",o);var c=e(n)({name:o,body:u,headers:i});return c?(n.resources[o]=c,n.emit("change",[o,{type:"update",value:c.body,time:d(c)}]),n.resources[o].body):(f("failed to register",o),!1)}},e=function(n){return function(r){return m("content-type")(r)||x(n.types).sort(w("priority")).some(o(r)),m("content-type")(r)?t(n)(r):(f("could not understand resource",r),!1)}},t=function(n){return function(r){var e=m("content-type")(r);return n.types[e]?(n.types[e].parse||p)(r):(f("could not understand type",e),!1)}},o=function(n){return function(r){return r.check(n)&&(n.headers["content-type"]=r.header)}},u=function(){return[S].reduce(j.obj("header"),1)},i=function(n,r){n.aliases={dst:{},src:{}};for(var e in r)n.link(r[e],e);return n},c=function(n){return function(r,e){n.aliases.src[r]=e,n.aliases.dst[e]=r,Object.defineProperty(n.resources,r,{get:function(){return n.resources[e]},set:function(r){n.resources[e]=r}})}},f=k("[ri/core]"),a=A("[ri/core]"),d=function(n,r){return r=g("body.log.length")(n),l.num(r)?r-1:r}})}();
