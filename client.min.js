var core=function(){"use strict";function n(n){return function(r){return r==n}}function r(n){return function(r){return d(r)(n)}}var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=function(){var n,r,e=new Promise(function(e,t){n=e,r=t});return arguments.length&&n(arguments[0]),e.resolve=n,e.reject=r,e},o=function n(r,e){return e instanceof Array&&(e=e.reduce(n,[])),(r=r||[]).concat(e)},u=function(n,r){return r in n},i=function(n,r,e,t){return n.host&&n.host.nodeName&&(n=n.host),r.name&&(e=r,r=r.name),!u(n,r)&&Object.defineProperty(n,r,{value:e,writable:t}),n[r]},c=function n(r){function e(n,e){return n.next?n.next(e):e instanceof Array?n.apply(r,e):n.call(r,e)}function u(n,r){for(var e=n.length;~--e;)r!=n[e]&&r!=n[e].fn&&r||n.splice(e,1)}function c(r,e){var o=n((e=e||{}).base||t());return o.i=0,o.li=[],o.fn=e.fn,o.parent=r,o.source=e.fn?o.parent.source:o,o.on("stop",function(){return o.type?o.parent.off(o.type,o):o.parent.off(o)}),o.each=function(n){var r=n.next?n:c(o,{fn:n});return o.li.push(r),r},o.pipe=function(n){return n(o)},o.map=function(n){return o.each(function(r,e,t){return t.next(n(r,e,t))})},o.filter=function(n){return o.each(function(r,e,t){return n(r,e,t)&&t.next(r)})},o.reduce=function(n,r){return o.each(function(e,t,o){return o.next(r=n(r,e,t,o))})},o.unpromise=function(){var n=c(o,{base:{},fn:function(r){return n.next(r)}});return o.li.push(n),n},o.next=function(n){return o.resolve&&o.resolve(n),o.li.length?o.li.map(function(r){return r.fn(n,r.i++,r)}):n},o.until=function(n){return n.each(function(){o.source.emit("stop")}),o},o.off=function(n){return u(o.li,n),o},o[Symbol.asyncIterator]=function(){return{next:function(){return o.wait=new Promise(function(n){o.wait=!0,o.map(function(r,e,t){delete o.wait,o.off(t),n({value:r,done:!1})}),o.emit("pull",o)})}}},o}return r=r||{},i(r,"emit",function(n,t,u){for(var i=r.on[n.split(".")[0]]||[],c=[],f=0;f<i.length;f++)i[f].ns&&u&&!u(i[f].ns)||c.push(e(i[f].isOnce?i.splice(f--,1)[0]:i[f],t));for(f=0;f<r.on["*"].length;f++)c.push(e(r.on["*"][f],[n,t]));return c.reduce(o,[])},1),i(r,"once",function(n,e){return r.on(n,e,!0)},1),i(r,"off",function(n,e){return u(r.on[n]||[],e),e&&e.ns&&delete r.on[n]["$"+e.ns],r},1),i(r,"on",function(n,e,t){function o(n){return n.isOnce=t,n.type=i,f&&(r.on[i]["$"+(n.ns=f)]=n),a.push(n),n.next?n:r}var i=n.split(".")[0],f=n.split(".")[1],a=r.on[i]=r.on[i]||[],s="function"==typeof e?e:0;return!s&&f?(s=r.on[i]["$"+f])?s:o(c(r,e)):s||f?s&&f?o((u(a,r.on[i]["$"+f]||-1),s)):!(!s||f)&&o(s):o(c(r,e))},1),r.on["*"]=r.on["*"]||[],r},f="undefined"!=typeof window,a=n;n.fn=function(n){return"function"==typeof n},n.str=function(n){return"string"==typeof n},n.num=function(n){return"number"==typeof n},n.obj=function(n){return"object"==typeof n},n.lit=function(n){return"object"==typeof n&&!(n instanceof Array)},n.bol=function(n){return"boolean"==typeof n},n.truthy=function(n){return 1==!!n},n.falsy=function(n){return 0==!!n},n.arr=function(n){return n instanceof Array},n.null=function(n){return null===n},n.def=function(n){return void 0!==n},n.in=function(n){return function(r){return!!n&&(n.indexOf?~n.indexOf(r):r in n)}},n.promise=function(n){return n instanceof Promise},n.stream=function(n){return!(!n||!n.next)};["red","green","bold","grey","strip"].forEach(function(n){!a.str(String.prototype[n])&&Object.defineProperty(String.prototype,n,{get:function(){return String(this)}})});var s=function(n){return n},p=function(n){return function(){return n}},l=function(n){return 0===n?"0":n?a.fn(n)?""+n:a.obj(n)?JSON.stringify(n):String(n):""},d=function n(r,e){var t=arguments.length>1,o=a.fn(r)?[]:l(r).split("."),u=o.shift();return function(i,c){var f={};return i?a.num(r)||r?a.arr(r)?(r.map(function(r){var e=n(r)(i);void 0!=e&&n(r,a.fn(e)?p(e):e)(f)}),f):i[r]||!o.length?t?(i[r]=a.fn(e)?e(i[r],c):e,i):a.fn(r)?r(i):i[r]:t?(n(o.join("."),e)(i[u]?i[u]:i[u]={}),i):n(o.join("."))(i[u]):i:void 0}},y=function(n,r){var e=1==arguments.length;return function(t){return t&&t.headers?e?d(n)(t.headers):d(n)(t.headers)==r:null}},h=function(n){return Object.keys(a.obj(n)||a.fn(n)?n:{})},g=function(n){return n.__data__},m=r;r.parent=function(n){return g(this.parentNode)[n]};var v=function(n){return n?h(n).map(m(n)):[]},b={arr:function(n){return Array.prototype.slice.call(n,0)},obj:function(n){function r(n,r,t){return 0===t&&(n={}),n[a.fn(e)?e(r,t):r[e]]=r,n}var e="id";return 1==arguments.length?(e=n,r):r.apply(this,arguments)}},x=function(n){return function(r,e){var t=d(n)(r)||"",o=d(n)(e)||"";return t>o?-1:t<o?1:0}},w=function(n){return function(r){return r&&r.indexOf&&~r.indexOf(n)}},j={header:"text/plain",check:function(n){return!w(".html")(n.name)&&!w(".css")(n.name)&&a.str(n.body)}},O=f?window:e,S=function(n){return function(r){if(!O.console||!console.error.apply)return r;a.arr(arguments[2])&&(arguments[2]=arguments[2].length);var e=b.arr(arguments),t="[err]["+(new Date).toISOString()+"]"+n;return e.unshift(t.red?t.red:t),console.error.apply(console,e),r}},A=function(n){return function(r){if(!O.console||!console.log.apply)return r;a.arr(arguments[2])&&(arguments[2]=arguments[2].length);var e=b.arr(arguments),t="[log]["+(new Date).toISOString()+"]"+n;return e.unshift(t.grey?t.grey:t),console.log.apply(console,e),r}};return function(n,r){return r={exports:{}},n(r,r.exports),r.exports}(function(n){n.exports=function(){function n(e,t,o){return e?a.arr(e)?e.map(n):a.promise(e)?e.then(n).catch(f):a.obj(e)&&!e.name?n(v(e)):a.fn(e)&&e.resources?n(v(e.resources)):a.str(e)&&!t&&n.resources[e]?n.resources[e].body:!a.str(e)||t||n.resources[e]?a.str(e)&&t?r(n)({name:e,body:t,headers:o}):a.obj(e)&&!a.arr(e)?r(n)(e):(f("could not find or create resource",e),!1):void 0:n}p("creating");return n.resources={},n.resource=i(n),n.register=n,n.types=u(),c(n)};var r=function(n){return function(t){var o=t.name,u=t.body,i=t.headers;if(void 0===i&&(i={}),p("registering",o),a.promise(u))return u.then(function(e){return r(n)({name:o,body:e,headers:i})}).catch(f);var c=e(n)({name:o,body:u,headers:i});return c?(n.resources[o]=c,n.emit("change",[o,{type:"update",value:c.body,time:l(c)}]),n.resources[o].body):(f("failed to register",o),!1)}},e=function(n){return function(r){return y("content-type")(r)||v(n.types).sort(x("priority")).some(o(r)),y("content-type")(r)?t(n)(r):(f("could not understand resource",r),!1)}},t=function(n){return function(r){var e=y("content-type")(r);return n.types[e]?(n.types[e].parse||s)(r):(f("could not understand type",e),!1)}},o=function(n){return function(r){return r.check(n)&&(n.headers["content-type"]=r.header)}},u=function(){return[j].reduce(b.obj("header"),1)},i=function(n){return function(){return n.apply(this,arguments),n}},f=S("[ri/core]"),p=A("[ri/core]"),l=function(n,r){return r=d("body.log.length")(n),a.num(r)?r-1:r}})}();
